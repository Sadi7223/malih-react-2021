{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/mathews/Reesby/React/NewMalihUI/src/views/app-views/components/data-entry/upload/UploadWithAliyunOss.js\";\nimport React, { Component } from \"react\";\nimport { Form, Upload, message, Button } from 'antd';\nimport { UploadOutlined } from '@ant-design/icons';\n\nclass AliyunOSSUpload extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      OSSData: {}\n    };\n\n    this.init = async () => {\n      try {\n        const OSSData = await this.mockGetOSSData();\n        this.setState({\n          OSSData\n        });\n      } catch (error) {\n        message.error(error);\n      }\n    };\n\n    this.mockGetOSSData = () => ({\n      dir: 'user-dir/',\n      expire: '1577811661',\n      host: '//www.mocky.io/v2/5cc8019d300000980a055e76',\n      accessId: 'c2hhb2RhaG9uZw==',\n      policy: 'eGl4aWhhaGFrdWt1ZGFkYQ==',\n      signature: 'ZGFob25nc2hhbw=='\n    });\n\n    this.onChange = ({\n      fileList\n    }) => {\n      const {\n        onChange\n      } = this.props;\n      console.log('Aliyun OSS:', fileList);\n\n      if (onChange) {\n        onChange([...fileList]);\n      }\n    };\n\n    this.onRemove = file => {\n      const {\n        value,\n        onChange\n      } = this.props;\n      const files = value.filter(v => v.url !== file.url);\n\n      if (onChange) {\n        onChange(files);\n      }\n    };\n\n    this.getExtraData = file => {\n      const {\n        OSSData\n      } = this.state;\n      return {\n        key: file.url,\n        OSSAccessKeyId: OSSData.accessId,\n        policy: OSSData.policy,\n        Signature: OSSData.signature\n      };\n    };\n\n    this.beforeUpload = async file => {\n      const {\n        OSSData\n      } = this.state;\n      const expire = OSSData.expire * 1000;\n\n      if (expire < Date.now()) {\n        await this.init();\n      }\n\n      const suffix = file.name.slice(file.name.lastIndexOf('.'));\n      const filename = Date.now() + suffix;\n      file.url = OSSData.dir + filename;\n      return file;\n    };\n  }\n\n  async componentDidMount() {\n    await this.init();\n  }\n\n  render() {\n    const {\n      value\n    } = this.props;\n    const props = {\n      name: 'file',\n      fileList: value,\n      action: this.state.OSSData.host,\n      onChange: this.onChange,\n      onRemove: this.onRemove,\n      data: this.getExtraData,\n      beforeUpload: this.beforeUpload\n    };\n    return /*#__PURE__*/_jsxDEV(Upload, { ...props,\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        icon: /*#__PURE__*/_jsxDEV(UploadOutlined, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 23\n        }, this),\n        children: \"Click to Upload\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nconst FormPage = () => /*#__PURE__*/_jsxDEV(Form, {\n  labelCol: {\n    span: 4\n  },\n  children: /*#__PURE__*/_jsxDEV(Form.Item, {\n    label: \"Photos\",\n    name: \"photos\",\n    children: /*#__PURE__*/_jsxDEV(AliyunOSSUpload, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 5\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 101,\n  columnNumber: 3\n}, this);\n\n_c = FormPage;\nexport class UploadWithAliyunOss extends Component {\n  render() {\n    return /*#__PURE__*/_jsxDEV(FormPage, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 12\n    }, this);\n  }\n\n}\nexport default UploadWithAliyunOss;\n\nvar _c;\n\n$RefreshReg$(_c, \"FormPage\");","map":{"version":3,"sources":["/home/mathews/Reesby/React/NewMalihUI/src/views/app-views/components/data-entry/upload/UploadWithAliyunOss.js"],"names":["React","Component","Form","Upload","message","Button","UploadOutlined","AliyunOSSUpload","state","OSSData","init","mockGetOSSData","setState","error","dir","expire","host","accessId","policy","signature","onChange","fileList","props","console","log","onRemove","file","value","files","filter","v","url","getExtraData","key","OSSAccessKeyId","Signature","beforeUpload","Date","now","suffix","name","slice","lastIndexOf","filename","componentDidMount","render","action","data","FormPage","span","UploadWithAliyunOss"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { Form, Upload, message, Button } from 'antd';\r\nimport { UploadOutlined } from '@ant-design/icons';\r\n\r\nclass AliyunOSSUpload extends React.Component {\r\n  state = {\r\n    OSSData: {},\r\n  };\r\n\r\n  async componentDidMount() {\r\n    await this.init();\r\n  }\r\n\r\n  init = async () => {\r\n    try {\r\n      const OSSData = await this.mockGetOSSData();\r\n\r\n      this.setState({\r\n        OSSData,\r\n      });\r\n    } catch (error) {\r\n      message.error(error);\r\n    }\r\n  };\r\n\r\n  // Mock get OSS api\r\n  // https://help.aliyun.com/document_detail/31988.html\r\n  mockGetOSSData = () => ({\r\n    dir: 'user-dir/',\r\n    expire: '1577811661',\r\n    host: '//www.mocky.io/v2/5cc8019d300000980a055e76',\r\n    accessId: 'c2hhb2RhaG9uZw==',\r\n    policy: 'eGl4aWhhaGFrdWt1ZGFkYQ==',\r\n    signature: 'ZGFob25nc2hhbw==',\r\n  });\r\n\r\n  onChange = ({ fileList }) => {\r\n    const { onChange } = this.props;\r\n    console.log('Aliyun OSS:', fileList);\r\n    if (onChange) {\r\n      onChange([...fileList]);\r\n    }\r\n  };\r\n\r\n  onRemove = file => {\r\n    const { value, onChange } = this.props;\r\n\r\n    const files = value.filter(v => v.url !== file.url);\r\n\r\n    if (onChange) {\r\n      onChange(files);\r\n    }\r\n  };\r\n\r\n  getExtraData = file => {\r\n    const { OSSData } = this.state;\r\n\r\n    return {\r\n      key: file.url,\r\n      OSSAccessKeyId: OSSData.accessId,\r\n      policy: OSSData.policy,\r\n      Signature: OSSData.signature,\r\n    };\r\n  };\r\n\r\n  beforeUpload = async file => {\r\n    const { OSSData } = this.state;\r\n    const expire = OSSData.expire * 1000;\r\n\r\n    if (expire < Date.now()) {\r\n      await this.init();\r\n    }\r\n\r\n    const suffix = file.name.slice(file.name.lastIndexOf('.'));\r\n    const filename = Date.now() + suffix;\r\n    file.url = OSSData.dir + filename;\r\n\r\n    return file;\r\n  };\r\n\r\n  render() {\r\n    const { value } = this.props;\r\n    const props = {\r\n      name: 'file',\r\n      fileList: value,\r\n      action: this.state.OSSData.host,\r\n      onChange: this.onChange,\r\n      onRemove: this.onRemove,\r\n      data: this.getExtraData,\r\n      beforeUpload: this.beforeUpload,\r\n    };\r\n    return (\r\n      <Upload {...props}>\r\n        <Button icon={<UploadOutlined />}>Click to Upload</Button>\r\n      </Upload>\r\n    );\r\n  }\r\n}\r\n\r\nconst FormPage = () => (\r\n  <Form labelCol={{ span: 4 }}>\r\n    <Form.Item label=\"Photos\" name=\"photos\">\r\n      <AliyunOSSUpload />\r\n    </Form.Item>\r\n  </Form>\r\n);\r\n\r\nexport class UploadWithAliyunOss extends Component {\r\n  render() {\r\n    return <FormPage />;\r\n  }\r\n}\r\n\r\nexport default UploadWithAliyunOss;\r\n"]},"metadata":{},"sourceType":"module"}