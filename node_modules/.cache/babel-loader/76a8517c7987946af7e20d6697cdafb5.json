{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/mathews/Reesby/React/NewMalihUI/src/views/app-views/components/data-display/tree/Draggable.js\";\nimport React, { Component } from \"react\";\nimport { Tree } from \"antd\";\nconst x = 3;\nconst y = 2;\nconst z = 1;\nconst gData = [];\n\nconst generateData = (_level, _preKey, _tns) => {\n  const preKey = _preKey || '0';\n  const tns = _tns || gData;\n  const children = [];\n\n  for (let i = 0; i < x; i++) {\n    const key = `${preKey}-${i}`;\n    tns.push({\n      title: key,\n      key\n    });\n\n    if (i < y) {\n      children.push(key);\n    }\n  }\n\n  if (_level < 0) {\n    return tns;\n  }\n\n  const level = _level - 1;\n  children.forEach((key, index) => {\n    tns[index].children = [];\n    return generateData(level, key, tns[index].children);\n  });\n};\n\ngenerateData(z);\nexport class Draggable extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      gData,\n      expandedKeys: ['0-0', '0-0-0', '0-0-0-0']\n    };\n\n    this.onDragEnter = info => {\n      console.log(info); // expandedKeys 需要受控时设置\n      // this.setState({\n      //   expandedKeys: info.expandedKeys,\n      // });\n    };\n\n    this.onDrop = info => {\n      console.log(info);\n      const dropKey = info.node.props.eventKey;\n      const dragKey = info.dragNode.props.eventKey;\n      const dropPos = info.node.props.pos.split('-');\n      const dropPosition = info.dropPosition - Number(dropPos[dropPos.length - 1]);\n\n      const loop = (data, key, callback) => {\n        for (let i = 0; i < data.length; i++) {\n          if (data[i].key === key) {\n            return callback(data[i], i, data);\n          }\n\n          if (data[i].children) {\n            loop(data[i].children, key, callback);\n          }\n        }\n      };\n\n      const data = [...this.state.gData]; // Find dragObject\n\n      let dragObj;\n      loop(data, dragKey, (item, index, arr) => {\n        arr.splice(index, 1);\n        dragObj = item;\n      });\n\n      if (!info.dropToGap) {\n        // Drop on the content\n        loop(data, dropKey, item => {\n          item.children = item.children || []; // where to insert 示例添加到头部，可以是随意位置\n\n          item.children.unshift(dragObj);\n        });\n      } else if ((info.node.props.children || []).length > 0 && // Has children\n      info.node.props.expanded && // Is expanded\n      dropPosition === 1 // On the bottom gap\n      ) {\n          loop(data, dropKey, item => {\n            item.children = item.children || []; // where to insert 示例添加到头部，可以是随意位置\n\n            item.children.unshift(dragObj); // in previous version, we use item.children.push(dragObj) to insert the\n            // item to the tail of the children\n          });\n        } else {\n        let ar;\n        let i;\n        loop(data, dropKey, (item, index, arr) => {\n          ar = arr;\n          i = index;\n        });\n\n        if (dropPosition === -1) {\n          ar.splice(i, 0, dragObj);\n        } else {\n          ar.splice(i + 1, 0, dragObj);\n        }\n      }\n\n      this.setState({\n        gData: data\n      });\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(Tree, {\n      className: \"draggable-tree\",\n      defaultExpandedKeys: this.state.expandedKeys,\n      draggable: true,\n      blockNode: true,\n      onDragEnter: this.onDragEnter,\n      onDrop: this.onDrop,\n      treeData: this.state.gData\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }, this);\n  }\n\n}\nexport default Draggable;","map":{"version":3,"sources":["/home/mathews/Reesby/React/NewMalihUI/src/views/app-views/components/data-display/tree/Draggable.js"],"names":["React","Component","Tree","x","y","z","gData","generateData","_level","_preKey","_tns","preKey","tns","children","i","key","push","title","level","forEach","index","Draggable","state","expandedKeys","onDragEnter","info","console","log","onDrop","dropKey","node","props","eventKey","dragKey","dragNode","dropPos","pos","split","dropPosition","Number","length","loop","data","callback","dragObj","item","arr","splice","dropToGap","unshift","expanded","ar","setState","render"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { Tree } from \"antd\";\r\n\r\nconst x = 3;\r\nconst y = 2;\r\nconst z = 1;\r\nconst gData = [];\r\n\r\nconst generateData = (_level, _preKey, _tns) => {\r\n  const preKey = _preKey || '0';\r\n  const tns = _tns || gData;\r\n\r\n  const children = [];\r\n  for (let i = 0; i < x; i++) {\r\n    const key = `${preKey}-${i}`;\r\n    tns.push({ title: key, key });\r\n    if (i < y) {\r\n      children.push(key);\r\n    }\r\n  }\r\n  if (_level < 0) {\r\n    return tns;\r\n  }\r\n  const level = _level - 1;\r\n  children.forEach((key, index) => {\r\n    tns[index].children = [];\r\n    return generateData(level, key, tns[index].children);\r\n  });\r\n};\r\ngenerateData(z);\r\n\r\nexport class Draggable extends Component {\r\n  state = {\r\n    gData,\r\n    expandedKeys: ['0-0', '0-0-0', '0-0-0-0'],\r\n  };\r\n\r\n  onDragEnter = info => {\r\n    console.log(info);\r\n    // expandedKeys 需要受控时设置\r\n    // this.setState({\r\n    //   expandedKeys: info.expandedKeys,\r\n    // });\r\n  };\r\n\r\n  onDrop = info => {\r\n    console.log(info);\r\n    const dropKey = info.node.props.eventKey;\r\n    const dragKey = info.dragNode.props.eventKey;\r\n    const dropPos = info.node.props.pos.split('-');\r\n    const dropPosition = info.dropPosition - Number(dropPos[dropPos.length - 1]);\r\n\r\n    const loop = (data, key, callback) => {\r\n      for (let i = 0; i < data.length; i++) {\r\n        if (data[i].key === key) {\r\n          return callback(data[i], i, data);\r\n        }\r\n        if (data[i].children) {\r\n          loop(data[i].children, key, callback);\r\n        }\r\n      }\r\n    };\r\n    const data = [...this.state.gData];\r\n\r\n    // Find dragObject\r\n    let dragObj;\r\n    loop(data, dragKey, (item, index, arr) => {\r\n      arr.splice(index, 1);\r\n      dragObj = item;\r\n    });\r\n\r\n    if (!info.dropToGap) {\r\n      // Drop on the content\r\n      loop(data, dropKey, item => {\r\n        item.children = item.children || [];\r\n        // where to insert 示例添加到头部，可以是随意位置\r\n        item.children.unshift(dragObj);\r\n      });\r\n    } else if (\r\n      (info.node.props.children || []).length > 0 && // Has children\r\n      info.node.props.expanded && // Is expanded\r\n      dropPosition === 1 // On the bottom gap\r\n    ) {\r\n      loop(data, dropKey, item => {\r\n        item.children = item.children || [];\r\n        // where to insert 示例添加到头部，可以是随意位置\r\n        item.children.unshift(dragObj);\r\n        // in previous version, we use item.children.push(dragObj) to insert the\r\n        // item to the tail of the children\r\n      });\r\n    } else {\r\n      let ar;\r\n      let i;\r\n      loop(data, dropKey, (item, index, arr) => {\r\n        ar = arr;\r\n        i = index;\r\n      });\r\n      if (dropPosition === -1) {\r\n        ar.splice(i, 0, dragObj);\r\n      } else {\r\n        ar.splice(i + 1, 0, dragObj);\r\n      }\r\n    }\r\n\r\n    this.setState({\r\n      gData: data,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <Tree\r\n        className=\"draggable-tree\"\r\n        defaultExpandedKeys={this.state.expandedKeys}\r\n        draggable\r\n        blockNode\r\n        onDragEnter={this.onDragEnter}\r\n        onDrop={this.onDrop}\r\n        treeData={this.state.gData}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nexport default Draggable;\r\n"]},"metadata":{},"sourceType":"module"}